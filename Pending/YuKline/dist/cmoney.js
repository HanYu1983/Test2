// Generated by LiveScript 1.6.0
(function(){
  var P, delay, query;
  P = require('prelude-ls');
  delay = function(t){
    return new Promise(function(res, rej){
      return setTimeout(res, t);
    });
  };
  query = function(){
    var info1, info2, info;
    info1 = (function(){
      var doms, i$, len$, dom, idDom, results$ = [];
      doms = $('#InventoryDetailListInfo > tr');
      for (i$ = 0, len$ = doms.length; i$ < len$; ++i$) {
        dom = doms[i$];
        idDom = $(dom).find("td > span")[0];
        results$.push([$(idDom).text()]);
      }
      return results$;
    }.call(this));
    info2 = (function(){
      var doms, i$, len$, dom, datas, stateDom, avgDom, ref$, _, stockNum, txNum, avg, results$ = [];
      doms = $('#InventoryDetailListData > tr');
      for (i$ = 0, len$ = doms.length; i$ < len$; ++i$) {
        dom = doms[i$];
        datas = $(dom).find("td"), stateDom = datas[0], avgDom = datas[1];
        ref$ = /(\d+) ?張\/ ?(\d+) ?張/g.exec($(stateDom).text()), _ = ref$[0], stockNum = ref$[1], txNum = ref$[2];
        avg = parseFloat($(avgDom).text());
        stockNum = parseFloat(stockNum);
        txNum = parseFloat(txNum);
        results$.push([stockNum, txNum, avg]);
      }
      return results$;
    }.call(this));
    return info = P.zipWith(curry$(function(x$, y$){
      return x$.concat(y$);
    }), info1, info2);
  };
  async function sell(){
    var infos, i$, len$, info, id, _, txCnt, avg, results$ = [];
    infos = query();
    for (i$ = 0, len$ = infos.length; i$ < len$; ++i$) {
      info = infos[i$];
      id = info[0], _ = info[1], txCnt = info[2], avg = info[3];
      $('#textBoxCommkey').focus().val(id);
      $('#TextBoxQty').focus();
      (await delay(500));
      $('#Bs_S')[0].checked = true;
      $('#Bs_S')[0].dispatchEvent(new Event("change"));
      (await delay(500));
      $('#TextBoxPrice').focus().val(avg * 1.01);
      $('#TextBoxQty').focus().val(txCnt);
      (await delay(1000));
      results$.push($('#Orderbtn').click());
    }
    return results$;
  }
  async function test(){
    (await delay(2000));
    $('a[href="#ID"]')[0].dispatchEvent(new Event("click"));
    (await delay(2000));
    return (await sell());
  }
  chrome.runtime.onMessage.addListener(function(message, sender, sendResponse){
    var ask;
    ask = message.ask;
    if (ask === "sell all") {
      sell();
      return sendResponse(true);
    }
  });
  function curry$(f, bound){
    var context,
    _curry = function(args) {
      return f.length > 1 ? function(){
        var params = args ? args.concat() : [];
        context = bound ? context || this : this;
        return params.push.apply(params, arguments) <
            f.length && arguments.length ?
          _curry.call(context, params) : f.apply(context, params);
      } : f;
    };
    return _curry();
  }
}).call(this);
